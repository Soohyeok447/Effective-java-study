# item17. 변경 가능성을 최소화하라

### 불변클래스

-   인스턴스 내부 값을 수정할 수 없는 클래스 (절대 수정 불가)
-   가변 클래스보다 설계하고 구현하기 쉽고 안전함 (오류 생길 여지가 적음)

### 불변으로 만들기 위한 다섯 가지 규칙

-   객체의 상태를 setter 제공 X
-   클래스 확장할 수 없도록 하기
-   모든 필드 final로 선언
-   모든 필드 private로 선언
-   자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 하기

### 불변 클래스 예시

```java
public final class Box {
    private final int width;
    private final int height;

    public Box(int width, int height){
        this.width = width;
        this.height = height;
    }

    pubolic Box plus(Box b){
        return new Box(width + b.width, height + b.height) // 새로운 Box 인스턴스를 생성해서 반환 (본인을 수정하지 않음)
    }
}
```

### 불변객체는 단순하다

-   생성된 시점의 상태를 파괴될 때까지 그대로 간직함 (신뢰가능하다)
-   근본적으로 스레드 안전하여 따로 동기화할 필요없음
-   스레드가 다른 스레드에 영향을 줄 수 없으니 안심하고 공유할 수 있기에 최대한 재활용할 것
-   불변 클래스는 정적 팩터리를 제공해서 캐싱이 가능해짐

### 불변 클래스 단점

-   값이 다르면 반드시 독립된 객체로 만들어야함

### 정리

-   getter가 있다고 setter를 무조건 만들 필요없음
-   꼭 필요한 경우가 아니면 클래스는 불변이어야 함 (장점이 많고 단점은 특정 상황에서의 잠재적 성능 저하 뿐)
-   단순한 값 객체(PhoneNumber같은)는 항상 불변으로 만들 것
-   모든 클래스를 불변으로 만들 순 없지만 변경 가능한 부분을 최소한으로 줄일 것
-   객체가 가질 수 있는 상태의 수를 줄이면 예측하기 쉬워지고 오류 발생 가능성이 줄어듬
-   합당한 이유가 없다면 모든 필드는 private final이어야 함
-   생성자는 초기화가 완벽히 끝난 상태의 객체를 생성해야 함
-   확실한 이유가 없으면 생성자와 정적 팩터리 외에는 그 어떤 초기화 메서드도 public으로 제공해서는 안됨
