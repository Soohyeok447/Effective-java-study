## Item 21: 인터페이스는 구현하는 쪽을 생각해 설계하라

자바 8에서 인터페이스에 **디폴트 메서드(default method)**가 추가돼 기존 구현체를 깨뜨리지 않고 인터페이스에 새로운 메서드를 추가할 수 있게 되었다. 하지만 위험이 완전히 사라진 것이 아니므로 디폴트 메서드를 추가할 때는 **구현하는 쪽의 입장을 반드시 고려**해야 한다.

---

### 1. 디폴트 메서드의 목적과 위험성

- 자바 8에서는 주로 람다를 활용하기 위해 핵심 컬렉션 인터페이스들에 다수의 디폴트 메서드가 추가되었다.
- 하지만 생각할 수 있는 모든 상황에서 불변식을 해치지 않는 디폴트 메서드를 작성하는 것은 매우 어렵다.
- Collection 인터페이스에 removeIf 디폴트 메서드가 추가되었다. 이 메서드의 구현은 반복자를 이용해 순회하며 각 원소를 remove 메서드로 제거하는 방식이다.

```java
// Collection 인터페이스에 추가된 디폴트 메서드
default boolean removeIf(Predicate<? super E> filter) {
    Objects.requireNonNull(filter);
    boolean result = false;
    for (Iterator<E> it = iterator(); it.hasNext(); ) {
        if (filter.test(it.next())) {
            it.remove();
            result = true;
        }
    }
    return result;
}
```

- apache.commons의 `SynchronizedCollection` 클래스는 클라이언트가 제공하는 객체로 락을 거는 기능을 제공한다. `removeIf`의 기본 구현은 동기화에 대해 아무것도 모르기 때문에 락 객체 없이 동작한다. 만약 다른 스레드가 동시에 컬렉션을 수정하면 `ConcurrentModificationException`이 발생하거나 데이터가 손상될 수 있다.

---

### 2. 인터페이스를 설계할 때는 세심한 주의를 기울여야 한다.

인터페이스에 디폴트 메서드를 추가하는 것은 기존 구현에 **알려지지 않은 새로운 메서드를 추가**하는 것이다. 따라서 새로운 메서드가 기존 구현체와 충돌하지 않을지 심사숙고 해야 한다.

- 기존 인터페이스에 디폴트 메서드를 새로 추가하는 것은 꼭 필요한 경우가 아니면 피해야 한다.
- 새 인터페이스의 경우엔 표준적인 메서드 구현을 제공하는 것은 손쉽게 구현을 하는데 도움을 주므로 아주 유용한 수단이다.

---

### 요약

- 디폴트 메서드라는 도구가 생겼더라도 **인터페이스를 설계할 때는 여전히 세심한 주의를 기울여야 한다.**
- 인터페이스를 릴리스 하기 전에 많은 테스트르르 거쳐 결함을 찾아야한다. 릴리스 한 후에는 **수정하기가 어렵거나 불가능 할  수도 있기 때문이다.**
