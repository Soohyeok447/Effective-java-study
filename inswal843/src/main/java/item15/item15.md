## Item 15: 클래스와 멤버의 접근 권한을 최소화하라

소프트웨어 설계의 가장 근간이 되는 원리는 **정보 은닉 (information hiding)**, 즉 **캡슐화(encapsulation)**다. 클래스와 멤버의 접근 권한을 가능한 한 좁혀 외부로부터 내부 구현을 완벽히 숨기는 것이 좋다. 이로써 시스템의 복잡도를 낮추고 결합도를 줄여 유지보수성을 크게 향상시킨다.

---

### 1. 캡슐화의 장점

- **시스템 개발 속도 향상:** 여러 컴포넌트를 병렬로 개발할 수 있다. 각 컴포넌트의 내부 구현을 몰라도 공개된 API를 통해 서로 연동할 수 있기 때문이다.
- **시스템 관리 비용 절감:** 각 컴포넌트의 내부 동작을 더 빨리 파악할 수 있고, 다른 컴포넌트에 영향을 주지 않고도 디버깅 및 수정이 가능하다.
- **성능 최적화 도움:** 시스템을 프로파일링해 최적화할 컴포넌트를 정한 다음(item 67), 다른 컴포넌트에 영향을 주지 않고 해당 컴포넌트만 최적화할 수 있다.
- **소프트웨어 재사용성 향상:** 독립적으로 동작하는 컴포넌트는 다른 시스템에서도 쉽게 가져다 쓸 수 있다.
- **큰 시스템 제작의 난이도 감소:** 시스템 전체가 완성되지 않은 상태에서도 각 컴포넌트의 동작을 검증하며 개발을 완료할 수 있다.

---

### 2. 접근 권한을 정하는 기본 원칙

**모든 클래스와 멤버의 접근 권한은 가능한 한 가장 좁은 범위로 설정해야 한다.** 외부에서 필요하지 않은 모든 것은 private으로 만드는 것에서 시작해야 한다.

### 접근 제어자(Access Modifier)의 범위

자바는 4가지 접근 수준을 제공한다. 범위가 좁은 순서대로 살펴보자.

1. **private**: 멤버를 선언한 **톱레벨 클래스 안에서만** 접근할 수 있다.
2. **package-private (default)**: 멤버가 소속된 **패키지 안의 모든 클래스**에서 접근할 수 있다. 접근 제어자를 명시하지 않으면 이 접근 수준이 된다.
3. **protected**: package-private의 접근 범위를 포함하며, 이 멤버를 선언한 클래스의 **상속한 하위 클래스**에서도 접근할 수 있다. (제약이 조금 따른다)
4. **public**: **모든 곳에서** 접근할 수 있다.

### 범위 선택 순서

- 우선 모든 멤버를 **private**으로 만들고 시작한다.
- 같은 패키지의 다른 클래스가 접근해야 한다면 **package-private**으로 풀어준다.
- 상속 관계에서 하위 클래스가 접근해야 한다면 **protected**로 풀어준다.
- 외부에 공개해야 하는 기능이라면 **public**으로 설정한다.

---

### 3. 주의사항

- **public 클래스의 인스턴스 필드는 되도록 public이 아니어야 한다(item 16).**
    - 필드에 직접 접근을 허용하면 캡슐화의 이점을 얻을 수 없다. 필드가 public이면 불변식을 보장할 수 없고, 외부에서 필드에 접근하는 코드가 많아지면 리팩터링이 거의 불가능해진다.
    - public 가변 필드를 가진 클래스는 **스레드 안전하지 않다.**
    - **예외:** 해당 클래스가 표현하는 추상 개념을 완성하는 데 꼭 필요한 구성요소라면 public static final 상수로 공개할 수 있다. 단, 이 상수는 기본 타입이나 불변 객체를 참조해야 한다(item 17).
    
    ```java
    // 나쁜 예: 가변 객체(배열)를 참조하는 public static final 상수
    public static final Thing[] VALUES = { ... };
    
    // 해결책 1: private으로 만들고 public 불변 리스트를 추가
    private static final Thing[] PRIVATE_VALUES = { ... };
    public static final List<Thing> VALUES = Collections.unmodifiableList(Arrays.asList(PRIVATE_VALUES));
    
    // 해결책 2: private으로 만들고 복사본을 반환하는 public 메서드를 추가
    private static final Thing[] PRIVATE_VALUES = { ... };
    public Thing[] values() { return PRIVATE_VALUES.clone(); }
    ```
    
- **모듈 시스템 (자바 9 이상)**
    - 자바 9부터 도입된 모듈 시스템에서는 public이라도 모듈 설정에서 export하지 않으면 모듈 외부에서 접근할 수 없다. 이는 패키지를 외부에 공개할지 여부를 한 번 더 제어할 수 있는 유용한 캡슐화 도구다.
    - 하지만 모듈 개념이 널리 받아들려질지 예측하기는 아직 이른감이 있어 꼭 필요한 경우가 아니면 당분간을 사용하지 않는게 좋을 것이다.

---

### 요약

- **정보 은닉(캡슐화)**은 소프트웨어 설계의 핵심이다.
- **가능한 모든 멤버를 private으로 만들라.**
- public 클래스는 상수용 public static final 필드를 제외하고는 어떠한 public 필드도 가져서는 안 된다.
